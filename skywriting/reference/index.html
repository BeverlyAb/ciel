<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Skywriting language reference</title>
    <link rel="shortcut icon" href="../../images/favicon.png">
    <link rel="stylesheet" type="text/css" href="../../style.css" media="screen">
    <link href="../../ext/sunburst.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="../../ext/prettify.js"></script>

    <meta name="generator" content="nanoc 3.1.6">
  </head>
  <body onload="prettyPrint()">
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-377063-3']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<div id="wrapper">
  <h1 class="pageheader">CIEL</h1>
  <div id="content">
    <div id="article-withsidebar">
      <h1 id="skywriting-language-reference">Skywriting language reference</h1>

<p>Skywriting contains many built-in functions, and various additional
functions via the <em>standard library</em>. This page provides a reference
to the interface of every Skywriting function.</p>

<h2 id="job-management-functions">Job management functions</h2>

<p>The core <em>job management functions</em> are the primitive interface
for interacting with a CIEL cluster.</p>

<h3 id="exec">exec()</h3>

<p>Executes an external piece of code, and waits for the result.</p>

<pre class="prettyprint">result = exec(executor, args, num_outputs);</pre>

<p>Let’s have something else in here.</p>

<table>
<thead><tr>
<th>Argument</th>
      <th>Description</th>
    </tr></thead>
<tbody>
<tr>
<td><code>executor</code></td>
      <td>The name of the CIEL <a href="../../executors/">executor</a>  to invoke.</td>
    </tr>
<tr>
<td><code>args</code></td>
      <td>A structure containing arguments for the executor. (Usually a dictionary.)</td>
    </tr>
<tr>
<td><code>num_outputs</code></td>
      <td>The number of outputs to expect.</td>
    </tr>
</tbody>
<tfoot><tr>
<td><code>result</code></td>
      <td>A list containing <code>num_outputs</code> references.</td>
    </tr></tfoot>
</table><h3 id="spawn">spawn()</h3>

<p>Creates a new task to compute a Skywriting function.</p>

<pre class="prettyprint">result = spawn(f, args);</pre>

<table>
<thead><tr>
<th>Argument</th>
      <th>Description</th>
    </tr></thead>
<tbody>
<tr>
<td><code>f</code></td>
      <td>The Skywriting function to compute.</td>
    </tr>
<tr>
<td><code>args</code></td>
      <td>A list of parameters to pass to <code>f</code>.</td>
    </tr>
</tbody>
<tfoot><tr>
<td><code>result</code></td>
      <td>A <em>future</em> reference to the result of <code>f(args)</code>.</td>
    </tr></tfoot>
</table><h3 id="spawnexec">spawn_exec()</h3>

<p>Creates a new task to execute and external piece of code.</p>

<pre class="prettyprint">result = spawn_exec(executor, args, num_outputs);</pre>

<table>
<thead><tr>
<th>Argument</th>
      <th>Description</th>
    </tr></thead>
<tbody>
<tr>
<td><code>executor</code></td>
      <td>The name of the CIEL <a href="../../executors/">executor</a>  to invoke.</td>
    </tr>
<tr>
<td><code>args</code></td>
      <td>A structure containing arguments for the executor. (Usually a dictionary.)</td>
    </tr>
<tr>
<td><code>num_outputs</code></td>
      <td>The number of outputs to expect.</td>
    </tr>
</tbody>
<tfoot><tr>
<td><code>result</code></td>
      <td>A list containing <code>num_outputs</code> references. <strong>N.B.</strong> These references are <em>futures</em>.</td>
    </tr></tfoot>
</table><h3 id="ref">ref()</h3>

<p>Creates a reference from a URL.</p>

<pre class="prettyprint">result = ref(url);</pre>

<table>
<thead><tr>
<th>Argument</th>
      <th>Description</th>
    </tr></thead>
<tbody><tr>
<td><code>url</code></td>
      <td>A string containing a URL. <strong>N.B.</strong> The <code>ref()</code> function presently only supports the <code>swbs://</code> URL scheme. For other URL schemes, use the <a href="#grab"><code>grab()</code></a> function.</td>
    </tr></tbody>
<tfoot><tr>
<td><code>result</code></td>
      <td>A reference to the object at the given URL.</td>
    </tr></tfoot>
</table><h2 id="utility-functions">Utility functions</h2>

<h3 id="getkey">get_key()</h3>

<p>Returns the value associated with the given <code>key</code> in <code>dict</code>, or
<code>default</code> if that key is not found in <code>dict</code>.</p>

<pre class="prettyprint">result = get_key(dict, key, default);</pre>

<table>
<thead><tr>
<th>Argument</th>
      <th>Description</th>
    </tr></thead>
<tbody>
<tr>
<td><code>dict</code></td>
      <td>The dictionary to be queried.</td>
    </tr>
<tr>
<td><code>key</code></td>
      <td>The key to be accessed.</td>
    </tr>
<tr>
<td><code>default</code></td>
      <td>A value to return in the case that <code>key</code> is not found in <code>dict</code>.</td>
    </tr>
</tbody>
<tfoot><tr>
<td><code>result</code></td>
      <td>The value associated with <code>key</code> in <code>dict</code>, or <code>default</code> if <code>key</code> is not found in <code>dict</code>.</td>
    </tr></tfoot>
</table><h3 id="haskey">has_key()</h3>

<p>Returns <code>true</code> if the given
<code>key</code> is found in <code>dict</code>, otherwise <code>false</code>.</p>

<pre class="prettyprint">result = has_key(dict, key);</pre>

<table>
<thead><tr>
<th>Argument</th>
      <th>Description</th>
    </tr></thead>
<tbody>
<tr>
<td><code>dict</code></td>
      <td>The dictionary to be queried.</td>
    </tr>
<tr>
<td><code>key</code></td>
      <td>The key to be accessed.</td>
    </tr>
</tbody>
<tfoot><tr>
<td><code>result</code></td>
      <td>
<code>true</code> if <code>key</code> is found in <code>dict</code>, otherwise <code>false</code>.</td>
    </tr></tfoot>
</table><h3 id="int">int()</h3>

<p>Returns the integer value of the given <code>input</code> (typically a string).</p>

<pre class="prettyprint">result = int(input);</pre>

<table>
<thead><tr>
<th>Argument</th>
      <th>Description</th>
    </tr></thead>
<tbody><tr>
<td><code>input</code></td>
      <td>The value to be converted.</td>
    </tr></tbody>
<tfoot><tr>
<td><code>result</code></td>
      <td>The integer value of <code>input</code>. If <code>input</code> cannot be converted, an error will be generated.</td>
    </tr></tfoot>
</table><h3 id="len">len()</h3>

<p>Returns the length of the given list.</p>

<pre class="prettyprint">result = len(list);</pre>

<table>
<thead><tr>
<th>Argument</th>
      <th>Description</th>
    </tr></thead>
<tbody><tr>
<td><code>list</code></td>
      <td>A list object.</td>
    </tr></tbody>
<tfoot><tr>
<td><code>result</code></td>
      <td>The number of elements in <code>list</code>.</td>
    </tr></tfoot>
</table><h3 id="map">map()</h3>

<p>Applies a function to each element of the given <code>list</code>, and returns
the resulting list.  Returns a list</p>

<pre class="prettyprint">include "mapreduce";
result = map(f, list);</pre>

<table>
<thead><tr>
<th>Argument</th>
      <th>Description</th>
    </tr></thead>
<tbody>
<tr>
<td><code>f</code></td>
      <td>A single-parameter Skywriting function, anonymous function or lambda expression.</td>
    </tr>
<tr>
<td><code>list</code></td>
      <td>A list object.</td>
    </tr>
</tbody>
<tfoot><tr>
<td><code>result</code></td>
      <td>A list containing <code>f(list[i])</code> for each element in <code>list</code>.</td>
    </tr></tfoot>
</table><h3 id="mapreduce">mapreduce()</h3>

<p>Applies the MapReduce algorithm to the given <code>list</code>. The given
<code>mapper</code> is applied to each element in the given <code>list</code>, generating
<code>num_outputs</code> outputs per element. These are then “shuffled” so that
<code>reducer</code> <em>i</em> receives the <em>i</em>th output of each <code>mapper</code>. The result
is a list containing the results of applying <code>reducer</code> to the collated
<code>num_outputs</code> outputs of the <code>mapper</code>s.</p>

<p><strong>N.B.</strong> This function does not create tasks, partition outputs
between reducers, or perform sorting on the inputs to reducers. To
create tasks, include <code>spawn()</code> or <code>spawn_exec()</code> in the definition of
<code>mapper</code> and <code>reducer</code>. Partitioning and sorting should be implemented
in <code>mapper</code> and <code>reducer</code> respectively.</p>

<pre class="prettyprint">include "mapreduce";
result = mapreduce(list, mapper, reducer, num_outputs);</pre>

<table>
<thead><tr>
<th>Argument</th>
      <th>Description</th>
    </tr></thead>
<tbody>
<tr>
<td><code>list</code></td>
      <td>A list object.</td>
    </tr>
<tr>
<td><code>mapper</code></td>
      <td>A single-parameter Skywriting function, anonymous function or lambda expression that returns a list of <code>num_outputs</code> results.</td>
    </tr>
<tr>
<td><code>reducer</code></td>
      <td>A single-parameter Skywriting function, anonymous function or lambda expression. <strong>N.B.</strong> This function must take a single parameter, which is a list, having the same length as <code>list</code>.</td>
    </tr>
<tr>
<td><code>num_outputs</code></td>
      <td>The number of outputs of each <code>mapper</code>, and hence the number of outputs of the overall <code>mapreduce()</code> function.</td>
    </tr>
</tbody>
<tfoot><tr>
<td><code>result</code></td>
      <td>A list of length <code>num_outputs</code>.</td>
    </tr></tfoot>
</table><h3 id="range">range()</h3>

<p>Returns a list of numbers within a given range.</p>

<pre class="prettyprint">result = range(stop);
result = range(start, stop);</pre>

<table>
<thead><tr>
<th>Argument</th>
      <th>Description</th>
    </tr></thead>
<tbody>
<tr>
<td><code>start</code></td>
      <td>The first number in the range. (Optional, defaults to <code>0</code>.)</td>
    </tr>
<tr>
<td><code>stop</code></td>
      <td>The first number outside the range.</td>
    </tr>
</tbody>
<tfoot><tr>
<td><code>result</code></td>
      <td>A list of <code>stop - start</code> integers, containing `[start, start + 1, …, stop - 1].</td>
    </tr></tfoot>
</table><h2 id="wrapper-functions">Wrapper functions</h2>

<p>The <em>wrapper functions</em> are convenience functions for invoking executors.</p>

<h3 id="environ">environ()</h3>

<p>Convenience function for spawning a task using the <a href="../../executors/environ"><code>environ</code> executor</a>.</p>

<pre class="prettyprint">include "environ";
result = environ(input_refs, command_line, num_outputs);</pre>

<table>
<thead><tr>
<th>Argument</th>
      <th>Description</th>
    </tr></thead>
<tbody>
<tr>
<td><code>input_refs</code></td>
      <td>A list of references to be used as inputs.</td>
    </tr>
<tr>
<td><code>command_line</code></td>
      <td>The command line to run, as a list of strings.</td>
    </tr>
<tr>
<td><code>num_outputs</code></td>
      <td>The number of outputs to expect.</td>
    </tr>
</tbody>
<tfoot><tr>
<td><code>result</code></td>
      <td>A list containing <code>num_outputs</code> future references.</td>
    </tr></tfoot>
</table><h3 id="grab">grab()</h3>

<p>Fetches the given URL into the cluster, and returns a reference to the resulting value.</p>

<pre class="prettyprint">include "grab";
result = grab(url);</pre>

<table>
<thead><tr>
<th>Argument</th>
      <th>Description</th>
    </tr></thead>
<tbody><tr>
<td><code>url</code></td>
      <td>The URL to fetch. <strong>N.B.</strong> Currently only the <code>http://</code> URL scheme is supported.</td>
    </tr></tbody>
<tfoot><tr>
<td><code>result</code></td>
      <td>A reference to the object at the given URL.</td>
    </tr></tfoot>
</table><h3 id="java">java()</h3>

<p>Convenience function for spawning a task using the <a href="../../executors/java"><code>java</code> executor</a>.</p>

<pre class="prettyprint">include "java";
result = java(class_name, input_refs, args, jar_refs, num_outputs);</pre>

<table>
<thead><tr>
<th>Argument</th>
      <th>Description</th>
    </tr></thead>
<tbody>
<tr>
<td><code>input_refs</code></td>
      <td>A list of references to be used as inputs.</td>
    </tr>
<tr>
<td><code>command_line</code></td>
      <td>The command line to run, as a list of strings.</td>
    </tr>
<tr>
<td><code>num_outputs</code></td>
      <td>The number of outputs to expect.</td>
    </tr>
</tbody>
<tfoot><tr>
<td><code>result</code></td>
      <td>A list containing <code>num_outputs</code> future references.</td>
    </tr></tfoot>
</table><h3 id="stdinout">stdinout()</h3>

<p>Convenience function for spawning a task using the <a href="../../executors/stdinout"><code>stdinout</code> executor</a></p>

<pre class="prettyprint">include "stdinout";
result = stdinout(input_refs, command_line);
result = stdinout_stream(input_refs, command_line);</pre>

<table>
<thead><tr>
<th>Argument</th>
      <th>Description</th>
    </tr></thead>
<tbody>
<tr>
<td><code>input_refs</code></td>
      <td>A list of references to be used as inputs.</td>
    </tr>
<tr>
<td><code>command_line</code></td>
      <td>The command line to run, as a list of strings.</td>
    </tr>
</tbody>
<tfoot><tr>
<td><code>result</code></td>
      <td>A list containing <code>num_outputs</code> future references.</td>
    </tr></tfoot>
</table>
    </div>
    <div id="sidebar">
      <p>Dummy sidebar text.</p>
    </div>
  </div>
  <div id="pagefooter">
    <hr />
    <p>Copyright 2011, CIEL project team.</p>
  </div>
</div>
</body>
</html>
